!function(t){var e={};function a(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=331)}({331:function(t,e,a){t.exports=a(332)},332:function(t,e,a){window.testData={test:null,timer:null,user:null,now:null,serverSecondsDifference:null,clockInterval:null,taskData:{}},window.testUtils||(window.testUtils={}),$("input.task-grade-points").on("change",function(){$(this).siblings(".input-group-btn").find("button").removeClass("btn-default").addClass("btn-primary")}),$(".wrap-for-banners").addClass("with-sidebar"),a(333),a(334),a(335),a(336),a(337),a(338)},333:function(t,e,a){var s={apiKey:"AIzaSyAkQaAVcCMajMmiqZUXJoeqjkktfgUzBHU",authDomain:"exams-p11018.firebaseapp.com",databaseURL:"https://exams-p11018.firebaseio.com",projectId:"exams-p11018",storageBucket:"exams-p11018.appspot.com",messagingSenderId:Object({MIX_FIREBASE_API_KEY:"AIzaSyAkQaAVcCMajMmiqZUXJoeqjkktfgUzBHU",MIX_FIREBASE_AUTH_DOMAIN:"exams-p11018.firebaseapp.com",MIX_FIREBASE_DATABASE_URL:"https://exams-p11018.firebaseio.com",MIX_FIREBASE_PROJECT_ID:"exams-p11018",MIX_FIREBASE_STORAGE_BUCKET:"exams-p11018.appspot.com",NODE_ENV:"production"}).MESSAGING_SENDER_ID},i={};window.realtime={init:function(t){firebase.initializeApp(s),firebase.auth().signInAnonymously().catch(function(t){t.code,t.message}),firebase.auth().onAuthStateChanged(function(e){e&&t(e)})},executeEvent:function(t,e){i[t]?i[t](e):console.error("Event "+t+" was not handled.")},on:function(t,e){i[t]=e},reloadOn:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&setTimeout(window.location.reload.bind(window.location),1e3*t)}}},334:function(t,e){testUtils.initializeRealtime=function(){realtime.init(testUtils.getTestData)},testUtils.getTestData=function(){var t=firebase.database().ref("tests/"+testData.test.id);if(userData&&"professor"===userData.role&&"finished"!==testData.test.status&&"graded"!==testData.test.status){var e=function(t,e){realtime.executeEvent("student.changed",{id:t,name:e.name,registered_at:e.registered_at,status:e.status})},a=firebase.database().ref("tests/"+testData.test.id+"/students");a.on("child_added",function(t){e(t.key,t.val())}),a.on("child_changed",function(t){e(t.key,t.val())}),a.on("child_removed",function(t){e(t.key,t.val())})}t.on("child_added",function(t){"published"===testData.test.status&&"started_at"===t.key&&(testData.test.status="started",realtime.executeEvent("test.started",t.val())),"started"===testData.test.status&&"finished_at"===t.key&&(testData.test.status="finished",realtime.executeEvent("test.finished",t.val()))})}},335:function(t,e){realtime.on("student.registered",function(t){var e=$("#test-registered-students .table");e.find("#student-"+t.id)||e.append("<tr "+testUtils.buildStudentRowAttributes(t.id)+"></tr>"),e.find("#student-"+t.id).html(testUtils.buildStudentRowColumns(t.id,t.name,moment(t.registered_at).fromNow(),"registered"))}),realtime.on("student.changed",function(t){var e=$("#test-registered-students .table");e.find("#student-"+t.id)||e.append("<tr "+testUtils.buildStudentRowAttributes(t.id)+"></tr>"),e.find("#student-"+t.id).html(testUtils.buildStudentRowColumns(t.id,t.name,moment(t.registered_at).fromNow(),t.status))})},336:function(t,e){testUtils.initiateTimer=function(){$(".test-timer-wrap").removeClass("hidden"),testUtils.setTimerTo(testData.timer.remaining_seconds),testData.timer.in_delay,realtime.reloadOn(testData.timer.remaining_seconds),testData.clockInterval=setInterval(function(){testData.timer.running&&testData.timer.remaining_seconds>0&&testUtils.setTimerTo(--testData.timer.remaining_seconds),!testData.test.can_register&&moment().add(testData.server_diff,"seconds").isAfter(testData.test.register_time)&&(testData.test.can_register=!0,$("#test-register").prop("disabled",!1))},1e3)},realtime.on("test.started",function(t){testUtils.setTimerTo(testData.timer.start_delay_in_seconds),testData.timer.running=!0,realtime.reloadOn(testData.timer.start_delay_in_seconds),"student"!=testData.user.role||testData.test.user_on_test||window.location.reload}),realtime.on("test.finished",function(t){testUtils.setTimerTo(testData.timer.finish_delay_in_seconds),testData.timer.running=!0,realtime.reloadOn(testData.timer.finish_delay_in_seconds)}),testUtils.setTimerTo=function(t){testData.timer.remaining_seconds=t;var e,a=Math.floor(t/60),s=Math.floor(a/60),i=(a=a%60,t%60);e=(s<10?"0":"")+s+":"+(a<10?"0":"")+a+":"+(i<10?"0":"")+i,$("#test-timer").text(e),testData.timer.in_delay?"published"===testData.test.status?$("#test-timer").addClass("green"):$("#test-timer").addClass("alarm"):($("#test-timer").removeClass("alarm"),$("#test-timer").removeClass("green"))}},337:function(t,e){var a=baseURL+"/tests/";function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object.assign(e,{_token:CSRF}),$.post(t,e,function(){a?a():location.reload()}).fail(function(t){showValidatorErrors(t)})}$("body").scrollspy({target:"#segment-list"}),$(".task-value").on("change",function(){testUtils.toggleButton($("#save-test"),"enable"),testUtils.toggleButton($("#save-draft-test"),"enable")}),$("#start-test").on("click",function(t){s(a+testData.test.id+"/start",{_token:CSRF},function(){$("#start-test").removeClass("btn-success").addClass("btn-default").prop("disabled",!1)})}),$("#finish-test").on("click",function(t){s(a+testData.test.id+"/finish",{},function(){$("#finish-test").removeClass("btn-danger").addClass("btn-default").prop("disabled",!1)})}),$("#publish-grade").on("click",function(t){s(a+testData.test.id+"/users/"+testData.test.for_student.id+"/publish-grade")}),$("#auto-grade").on("click",function(t){s(a+testData.test.id+"/users/"+testData.test.for_student.id+"/auto-grade")}),$("#auto-calculate-test").on("click",function(t){s(a+testData.test.id+"/auto-calculate")}),$("#publish-test-grades").on("click",function(t){s(a+testData.test.id+"/publish-grades")}),$("#save-test").on("click",function(t){testUtils.saveTest(!0)}),$("#save-draft-test").on("click",function(t){testUtils.saveTest()}),testUtils.toggleButton=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";switch(e){case"disable":t.prop("disabled",!0),t.addClass("btn-default");break;case"enable":t.prop("disabled",!1),t.removeClass("btn-default")}""!==a&&t.html(a)},testUtils.saveTest=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];$("#test-student-segments .task-wrap").each(function(t){var a=$(this).attr("data-task-type");e.push(function(t,e){var a={id:t.attr("data-task-id"),type:e};switch(e){case"rmc":case"cmc":a.data=[],t.find(".task-list .task-choice").each(function(t){var e,s,i=(e=$(this),s={},e.find(".task-value").each(function(t){$(this).attr("data-value-prop")?"checked"==$(this).attr("data-value-prop")&&(s[$(this).attr("data-key")]=$(this).is(":checked")?1:0):$(this).attr("data-value")&&(s[$(this).attr("data-key")]=$(this).attr("data-value"))}),s);a.data.push(i)});break;case"free_text":a.data=t.find("textarea").val();break;case"correspondence":a.data=[],t.find(".choice-wrap").each(function(t){var e={side_a:$(this).find("input.side-a").val(),side_b:$(this).find("input.side-b").val()};""!=e.side_a&&""!=e.side_b&&a.data.push(e)});break;case"code":a.data.push({id:t.find(".task-code input").val(),description:t.find(".task-code textarea").val()})}return a}($(this),a))}),s(a+testData.test.id+"/submit",{final:t?1:0,answers:e},function(){testUtils.toggleButton($("#save-test"),"enable","Save"+(t?"":' <span class="badge">1</span>')),testUtils.toggleButton($("#save-draft-test"),"disable"),t&&testUtils.toggleButton($("#save-test"),"disable")})}},338:function(t,e){var a=".task-wrap.task-wrap-correspondence#panel-task-";function s(t){var e={};return $(a+t).find(".choice-wrap").each(function(){e[$(this).find("input.side-a").val()]={value:$(this).find("input.side-b").val(),element:$(this).find("input.side-b")}}),e}function i(t,e){$(a+t+" .panel-body .choice-wrap").each(function(){var t=$(this).find("input.side-b").val(),a=""===t;$(this).find("input.side-b").val(a?"":t),$(this).find("button.choice-button .text-overflow").text(a?"Option":t),a?$(this).find("button.choice-button").removeClass("btn-primary").addClass("btn-default"):$(this).find("button.choice-button").removeClass("btn-default").addClass("btn-primary");var s=Object.values(e);$(this).find(".choice-side-b").removeClass("active").removeClass("selected").each(function(){var e=$(this).find("a").text();t===e?$(this).addClass("active"):s.indexOf(e)>-1&&$(this).addClass("selected")})})}$(".choice-side-b a").click(function(t){t.preventDefault();var e=$(this).text(),a=$(this).closest(".input-group"),n=a.find("input.side-a").val(),r=a.closest(".task-wrap").attr("data-task-id"),o=s(r),d={};Object.keys(o).forEach(function(t){o[t].value===e&&o[t].element.val(""),d[t]=o[t].value}),a.find("input.side-b").val(e),d[n]=e,i(r,d),testUtils.toggleButton($("#save-test"),"enable"),testUtils.toggleButton($("#save-draft-test"),"enable")}),$(".task-wrap.task-wrap-correspondence").each(function(){var t=$(this).attr("data-task-id"),e=s(t),a={};Object.keys(e).forEach(function(t){a[t]=e[t].value}),i(t,a)})}});